<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Swift Package Index Blog"/><link rel="canonical" href="https://blog.swiftpackageindex.com/posts/building-3238-packages-for-apple-silicon"/><meta name="twitter:url" content="https://blog.swiftpackageindex.com/posts/building-3238-packages-for-apple-silicon"/><meta name="og:url" content="https://blog.swiftpackageindex.com/posts/building-3238-packages-for-apple-silicon"/><title>Building 3,238 Swift Packages for Apple Silicon&ndash;Swift Package Index Blog</title><meta name="twitter:title" content="Building 3,238 Swift Packages for Apple Silicon&ndash;Swift Package Index Blog"/><meta name="og:title" content="Building 3,238 Swift Packages for Apple Silicon&ndash;Swift Package Index Blog"/><meta name="description" content="As part of the Swift Package Index build system, we have processed what must be the most extensive test of Apple Silicon compatibility outside of Apple. Here‚Äôs what we found."/><meta name="twitter:description" content="As part of the Swift Package Index build system, we have processed what must be the most extensive test of Apple Silicon compatibility outside of Apple. Here‚Äôs what we found."/><meta name="og:description" content="As part of the Swift Package Index build system, we have processed what must be the most extensive test of Apple Silicon compatibility outside of Apple. Here‚Äôs what we found."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" type="text/css"/><link rel="stylesheet" href="/main.css?1620156512" type="text/css"/><script src="/main.js?1620156512"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Swift Package Index Blog"/><script async defer data-domain="blog.swiftpackageindex.com" src="https://plausible.io/js/plausible.outbound-links.js"></script>
<script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script></head><body><header><div class="inner"><a href="/"><h1><img src="/images/logo.svg"/>The Swift Package Index Blog</h1></a><nav><a href="https://swiftpackageindex.com">Visit the Swift Package Index</a></nav></div></header><main><div class="inner"><h2 class="post"><a href="/posts/building-3238-packages-for-apple-silicon">Building 3,238 Swift Packages for Apple Silicon</a></h2><small>Posted <a href="/posts/building-3238-packages-for-apple-silicon">Wednesday, September 9, 2020</a>.</small><hr class="post"></hr><p>As part of the <a href="/posts/launching-language-and-platform-package-compatibility/">Swift Package Index build system</a>, we have processed what must be the most extensive test of Apple Silicon compatibility outside of Apple.</p><p>At the time of writing, we currently have 12,942 Apple Silicon builds in our database covering 3,238 packages. Why so many? We test up to <a href="https://swiftpackageindex.com/SwifQL/SwifQL/builds">three versions of each package</a> and compile each version with both <code>xcodebuild</code> and <code>swift build</code>.</p><p>I‚Äôm sure that many of the Apple Silicon DTK machines Apple shipped around the world are working very hard, testing apps for compatibility, but I‚Äôm not sure any of them have worked quite as hard as ours has. üöÄ</p><h2>What did we find?</h2><p>As you might expect, there‚Äôs plenty of good news. For packages with successful Intel builds, the <em>vast majority</em> also successfully build for Apple Silicon. üëç</p><p>There are failures, though, and the most interesting failures are where the build fails on Apple Silicon while the corresponding Intel build succeeds. In cases like this, that indicates a compatibility issue that will potentially need some attention from the package author. We‚Äôve identified 139 packages (~4%) where this is the case, and have <a href="https://gist.github.com/daveverwer/ae08ad14a7a975e0488503282b4f1dbf">compiled a list of them for reference</a>.</p><p>There are a few common errors that we‚Äôre observing in these failures, and most of them are from one of the following problems:</p><ul><li>Any inline assembly will fail, obviously!</li><li><code>Float80</code> is unavailable.</li><li><code>x86_thread_state64_t</code> is unavailable.</li><li><code>__darwin_arm_thread_state64' has no member '__rsp'</code>.</li><li><code>cannot convert value of type 'CVaListPointer' to expected argument type '__darwin_va_list?'</code>.</li><li>Sometimes, the compiler crashes!</li></ul><p>Even though 139 failing packages might sound like a lot, it‚Äôs not that bad, especially when you consider that many of the failures all fail due to an issue in a common base dependency, <a href="https://swiftpackageindex.com/PerfectlySoft/Perfect"><code>PerfectLib</code></a>.</p><h2>Where do we go from here?</h2><p>Even though the results are generally positive, it does show that there‚Äôs a bit of work that the community need to do to ensure the transition to Apple Silicon is as smooth as possible.</p><p>If you‚Äôre a package author and do not have a DTK machine at your disposal, please feel free to use ours via the Swift Package Index build system! Make changes to your packages, push them to a pre-release tag (for example, X.X.X-arm-beta-X) and the build system will pick up that tag and build it. You should see new build results, usually within a couple of hours of pushing a tag.</p><p>If you have any problems with the build system, there‚Äôs a couple of ways to contact us. We‚Äôre in the <code>#swiftpackageindex</code> channel over at the <a href="https://swift-package-manager.herokuapp.com">SwiftPM Slack</a>, or if it looks like there might be something wrong, please <a href="https://github.com/SwiftPackageIndex/SwiftPackageIndex-Server/issues/new">raise an issue on GitHub</a>.</p><hr/><div class="what">The <a href="https://swiftpackageindex.com">Swift Package Index</a> is a search engine for Swift packages with one goal. <strong>To help you make better decisions about dependencies.</strong> For more information, the best place to start is with the <a href="https://swiftpackageindex.com/faq">Frequently Asked Questions</a>.</div></div></main><footer><div class="inner"><nav><ul><li><a href="https://swiftpackageindex.com/privacy">Privacy and Cookies</a></li><li><a href="https://twitter.com/swiftpackages">Twitter</a></li></ul><p><a href="https://github.com/sponsors/SwiftPackageIndex">Please consider supporting this project</a></p><small>Kindly hosted by<a href="https://macstadium.com/">MacStadium</a></small></nav></div></footer></body></html>